<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
   <head>
      <meta name="description" content="">
      <title>ROL CABLE NETWORK</title>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="shortcut icon" type="image/icon" href="images/favicon.jpeg"/>
      <link rel="stylesheet" href="/css/bootstrap.min.css">
      <style>
        body {
            background-color: #06697e;
            color: white;
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
        }
        input[type="text"], 
		input[type="password"] {
		    width: 100%;
		    padding: 10px;
		    margin-bottom: 15px;
		    border: 1px solid #ccc;
		    border-radius: 4px;
		    font-size: 14px;
		    color: black !important;
		    background-color: white !important;
		}
		
		input:-webkit-autofill {
		    background-color: white !important;
		    color: black !important;
		}
        .tile {
            background: white;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            padding: 30px;
            max-width: 500px;
            width: 100%;
        }
        .tile-title {
            color: #06697e;
            font-size: 18px;
            text-transform: uppercase;
            margin-bottom: 20px;
            font-weight: bold;
        }
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 10px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
            background-color: #fff;
        }
        button {
            background-color: #06697e;
            color: white;
            border: none;
            padding: 12px 15px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 5px;
            width: 100%;
            transition: background-color 0.3s ease, transform 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        button:hover {
            background-color: #05586d;
            transform: scale(0.98);
        }
        button:disabled {
            background-color: gray;
            cursor: not-allowed;
        }
        #loader {
            display: none;
            width: 16px;
            height: 16px;
            border: 2px solid white;
            border-top: 2px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #cancelButton {
		    background-color: #ccc;
		    color: black;
		    border: none;
		    padding: 12px 15px;
		    font-size: 16px;
		    font-weight: normal;
		    cursor: pointer;
		    border-radius: 5px;
		    width: 100%;
		    transition: background-color 0.3s ease, transform 0.2s ease;
		}
		#cancelButton:hover {
		    background-color: #bbb;
		    transform: scale(0.98);
		}
      </style>
   </head>
   <body>
      <div class="tile">
         
         <h1 class="tile-title text-center">ROL CABLE NETWORK</h1>
         
         <form th:action="@{/saveChangedPassword}" method="post">
            <!-- Dummy fields to confuse browsers - Start -->
            <input type="text" style="display: none;" autocomplete="username">
            <input type="password" style="display: none;" autocomplete="off">
            <!-- Dummy fields to confuse browsers - End -->
            
            <input type="text" name="phone" id="phone" placeholder="Phone Number" th:value="${phone}" readonly />
            <input type="password" name="oldPassword" id="oldPassword" placeholder="Enter Old Password" autocomplete="off" readonly onfocus="this.removeAttribute('readonly');"/>
            <input type="password" name="newPassword" id="newPassword" placeholder="Enter New Password" autocomplete="new-password" readonly onfocus="this.removeAttribute('readonly');"/>
            <input type="password" id="confirmPassword" placeholder="Enter New Password Again" autocomplete="new-password" readonly onfocus="this.removeAttribute('readonly');"/>
            
            <div style="display: flex; gap: 10px;">
			    <button type="button" id="cancelButton" onclick="window.history.back()">
			        Back
			    </button>
			    <button type="submit" id="submitButton" onclick="return validateSignupForm()" disabled>
			        <span>Change Password</span>
			        <span id="loader"></span>
			    </button>
			</div>

         </form>
         
         <div id="validationMessage" style="color: red; margin-top: 5px;"></div>
         <div th:if="${successMessage}" th:text="${successMessage}" class="alert alert-success"></div>
         <div th:if="${errorMessage}" th:text="${errorMessage}" class="alert alert-danger"></div>
         
      </div>
      
      <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll('#oldPassword').forEach(function (input) {
                input.addEventListener("change", validateSignupForm);
            });
            document.querySelectorAll('#confirmPassword, #newPassword').forEach(function (input) {
                input.addEventListener("input", validateSignupForm);
            });
            var validationMessage = document.getElementById("validationMessage");
            validationMessage.textContent = "Please enter your old password.";
        });

        document.getElementById("submitButton").addEventListener("click", function () {
            if (!this.disabled) {
                document.getElementById("loader").style.display = "inline-block";
            }
        });

        function validateSignupForm() {
		    var oldPassword = document.getElementsByName("oldPassword")[0].value;
		    var newPassword = document.getElementById("newPassword").value;
		    var confirmPassword = document.getElementById("confirmPassword").value;
		    var submitButton = document.getElementById("submitButton");
		    var validationMessage = document.getElementById("validationMessage");

		    // Reset message
		    validationMessage.textContent = "";

		    if (oldPassword.trim() === "") {
		        validationMessage.textContent = "Please enter your old password.";
		        submitButton.disabled = true;
		        validationMessage.style.color = "red";
		        return false;
		    }

		    if (newPassword.trim() === "") {
		        validationMessage.textContent = "Please enter a new password.";
		        submitButton.disabled = true;
		        validationMessage.style.color = "red";
		        return false;
		    }

		    // Check if new password meets security criteria
		    var passwordRegex = /^(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
		    if (!passwordRegex.test(newPassword)) {
		        validationMessage.textContent = "New password must be at least 8 characters long and include an uppercase letter, a number, and a special character.";
		        submitButton.disabled = true;
		        validationMessage.style.color = "red";
		        return false;
		    }
		    
		    if (confirmPassword.trim() === "") {
		        validationMessage.textContent = "Please confirm your new password.";
		        submitButton.disabled = true;
		        validationMessage.style.color = "red";
		        return false;
		    }

		    if (newPassword !== confirmPassword) {
		        validationMessage.textContent = "New password and confirm password do not match.";
		        submitButton.disabled = true;
		        validationMessage.style.color = "red";
		        return false;
		    }

		    // Success - Enable button and clear message
		    submitButton.disabled = false;
		    validationMessage.style.color = "green";
		    validationMessage.textContent = "Password looks good! You can now change your password.";
		    return true;
		}
      </script>
   </body>
</html>
